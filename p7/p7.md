# Practica 7 - ASO

## MAQUINA 1
### Solaris 10

## Solaris 10

### OpenBSD 6.8

### Devuan
Creamos una partición nueva desde *Devuan*
```bash
#!/bin/bash

set -e

PARTITION_ENDS=$(\
`# Obtenemos las posiciones de las particiones con fdisk`
fdisk -l \
`# Busca el header de fdisk y muestra las 10 lineas siguientes` \
| grep -EA10 "^Device\s+Boot\s+Start\s+End\s+Sectors\s+Size\s+Id\s+Type$" \
`# Elimina el header de fdisk` \
| tail -n+2 \
`# Elimina espacios y el asterisco de boot (para que coincidan las columnas)` \
| tr -d '\*' | tr -s '[:blank:]' ' ' \
`# Obtiene la tercera columna (end)` \
| cut -d " " -f3
)
echo "$PARTITION_ENDS"

# Obtiene el offset mayor (la ultima particion, aunque esten desordenadas)
LAST_PARTITION_END=$(echo "${PARTITION_ENDS[*]}"| sort -nr | head -n1)

# La salida de fdisk es en sectores, no en bytes
#MEGABYTE_START=$(numfmt --to iec --format "%8.4f" $LAST_PARTITION_END)

# Creamos particion con tamaño en sectores, parted nos propondra utilizar
# la posicion alineada más cercana. Confirmamos.
parted -a optimal /dev/sda mkpart primary ext4 ${LAST_PARTITION_END}s 100%¨

PARTITION=$(fdisk -l | tail -n 3 | cut -d " " -f1 | tr -d " \n")

# Creamos el sistema de ficheros
mkfs.ext4 $PARTITION

# Creamos el punto de montaje
MOUNT_POINT="/data1"
mkdir "$MOUNT_POINT"

# Obtenemos el uuid de la particion que acabamos de crear
PART_UUID=$(sudo blkid -s UUID -o value $PARTITION)

# Actualizamos /etc/fstab
echo "UUID=$PART_UUID   $MOUNT_POINT    ext4    0   0" >> /etc/fstab

# Montamos manualmente
mount $PARTITION "$MOUNT_POINT"

```

## MAQUINA 2
### VirtualBox
Añadimos el disco a la máquina ASO2:
- Configuración
  - Almacenamiento
    - Controlador: IDE -> Agregar
      - Crear
        - Modo experto
          - Tamaño de archivo *4,00 GB*
          - Tipo de archivo de disco duro *VMDK (Virtual Machine Disk)*
          - Almacenamiento en disco duro *Reservado dinámicamente*
      - Seleccionamos *ASO2_1.vmdk*
      - Seleccionar
  - Aceptar

El resultado debería ser

![Dispositivos de almacenamiento en ASO2](./img/hdd_aso2.png)
### FreeBSD
Comenzaremos primero por FreeBSD.

Instalamos gdisk para editar la tabla de particiones:
```bash
pkg install -y gdisk
```

Tras esto ejecutamos
```bash
gdisk /dev/ada1
```
y procedemos con los siguientes inputs
- **o** (**Y**es)
- **n**
  - \<ENTER\> (Partition number 1)
  - \<ENTER\> (First sector 2048)
  - +2GB
  - \<ENTER\> (A503 FreeBSD UFS)
- **n**
  - \<ENTER\> (Partition number 2)
  - \<ENTER\> (First sector 4196352)
  - \<ENTER\> (Last sector 8388574)
  - 8300 (Linux filesystem)
- **w** (**Y**es)
  
Ante el aviso que nos arroja ejecutamos
```bash
reboot
```

Tras reiniciar, ya se nos debería auto crear los archivos `/dev/ada1p1` y `/dev/ada1p2`. El primero lo formatearemos en FreeBSD UFS.
```bash
newfs /dev/ada1p1
```

Tras esto volvemos a reiniciar, esta vez a fedora, ya que por el momento, hemos terminado.

### Fedora
TEST

## MAQUINA 3
### Solaris 11

### Ubuntu
