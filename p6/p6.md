# Practica 6 - ASO

## Solaris 10
### Instalación Interactiva de VBox Additions
```bash
#!/bin/bash

set -e

echo "Inserta el CD de VirtualBox Guest Additions, espera a que se automonte, y pulsa <ENTER> para continuar..."
read
pushd /cdrom/vboxadditions_* > /dev/null

pkgadd -d ./VBoxSolarisAdditions.pkg

popd > /dev/null

echo "Recuerda reiniciar o reloguear para aplicar las Guest Additions! (<ENTER> para continuar instalando)"
read

mkdir -p /export/home/pc/pkg
pushd /export/home/pc/pkg > /dev/null

# Descargamos los paquetes
/usr/sfw/bin/wget "http://www.dc.fi.udc.es/~afyanez/Docencia/2021/Grado/files/FSWpart.tar.gz" --no-check-certificate & 
/usr/sfw/bin/wget "http://www.dc.fi.udc.es/~afyanez/Docencia/2021/Grado/files/FSWfsmisc.tar.gz" --no-check-certificate  & 
/usr/sfw/bin/wget "https://get.geo.opera.com/ftp/pub/opera/unix/solaris/1011/en/intel/opera-10.11.gcc4-static-qt3.pkg.gz" --no-check-certificate &
wait

gunzip FSWpart.tar.gz &
gunzip FSWfsmisc.tar.gz &
gunzip opera-10.11.gcc4-static-qt3.pkg.gz &
wait

tar xvf FSWpart.tar &
tar xvf FSWfsmisc.tar &
wait

pkgadd -d . FSWpart
pkgadd -d . FSWfsmisc
pkgadd -d ./opera-10.11.gcc4-static-qt3.pkg

popd > /dev/null
echo "Comprueba que Opera funciona (/usr/local/bin/opera) y listo!"
```

## OpenBSD 6.8

### Instalación de paquetes, ports y entorno gráfico
```bash
#!/bin/ksh

# Salir si ocurre un error
set -e

# Habilitar login grafico
echo "Habilitar xenodm"
rcctl enable xenodm

packages="firefox icewm"
echo "Instalar paquetes: $packages"
#pkg_info $packages
pkg_add $packages

echo "Establecer icewm como window manager de user001-005"
i=1
while [ $i -le 10 ]
do
  username=$(printf "user%03d" $i)
  echo "Setting icewm as $username's wm"
  userhome=$(getent passwd $username | cut -d: -f6)
  echo "exec icewm" > $userhome/.xsession
  i=$((i+1))
done

echo "Y tambien para pc"
username=pc
echo "Setting icewm as $username's wm"
userhome=$(getent passwd $username | cut -d: -f6)
echo "exec icewm" > $userhome/.xsession

echo "Configurar un solo escritorio en fvwm de forma global"
# Explicacion del comando
# -i: Modificar archivo sobre si mismo (no enviar a stdout)
# /: Buscar texto
# ^DeskTopSize 3x3$: Busca el texto entre inicio y fin de linea
# /s: Sustituir texto
#     /^ Cambiar "inicio de linea"
#     /# por "#"
#     /; finalizar comando
#     /^#DesktopSize 3x3$: buscar
#     /a: Append texto
sed -i '/^DeskTopSize 3x3$/s/^/#/;/^#DeskTopSize 3x3$/a\
DeskTopSize 1x1' /usr/X11R6/lib/X11/fvwm/.fvwmrc

# Instala sistema de ports
echo "Sistema de ports"
mirror="https://cdn.openbsd.org/pub/OpenBSD/"
#mirror="https://cloudflare.cdn.openbsd.org/pub/OpenBSD/"
cd /tmp
# Descarga del archivo ports
ftp $mirror$(uname -r)/{ports.tar.gz,SHA256.sig}

# Comprueba que esta firmado con la clave privada de openbsd
echo "Comprobando firmas digitales"
signify -Cp /etc/signify/openbsd-$(uname -r | cut -c 1,3)-base.pub -x SHA256.sig ports.tar.gz
cd -

echo "Descomprimir ports.tar.gz en /usr/ports"
tar xzf /tmp/ports.tar.gz -C /usr
rm /tmp/ports.tar.gz

# Añade portslist al gestor de paquetes del sistema
pkg_add portslist

# Ejemplos de busqueda
#cd /usr/ports
#make search name=links
#make search key=lynx

# Numero de procesadores del sistema para paralelizar make
NJOBS=`sysctl -n hw.ncpu`

cd /usr/ports/www/links
make -j$NJOBS
make install
cd -

cd /usr/ports/www/lynx
make -j$NJOBS
make install
cd -

echo "Presiona una tecla para arrancar xenodm"
read
rcctl start xenodm
```

### Listado de paquetes instalados
```pkg_info -a``` para listar paquetes instalados,
```pkg_info -A``` para incluír los de sistema


## Devuan
```bash
#!/bin/bash

set -e

apt update -y && apt upgrade -y
apt install mate-desktop-environment build-essential dkms linux-headers-$(uname -r) strace slim -y

echo "Inserta el CD de VirtualBox Guest Additions, espera a que se automonte, y pulsa <ENTER> para continuar..."
read
sh /media/cdrom0/VBoxLinuxAdditions.run

# Rerun LILO (habria que quitar el hook de GRUB pero me puede la pereza)
echo "Modifica /etc/lilo.conf y actualiza la versión de linux a la última instalada y pulsa <ENTER> para continuar..."
read
lilo

echo "Recuerda reiniciar para aplicar las Guest Additions! (ya puedes expulsar el CD)"
```


## Fedora
### Instalación de VBoxGuest
Las VirtualBox Guest Additions se instalan durante la configuración inicial si
el instalador detecta que el hipervisor es VirtualBox. Si esto no ocurre, se
puede hacer manualmente con `yum install virtualbox-guest-additions.x86_64`.

Además, durante la configuración inicial, ya instalamos el entorno mate y el
login lightdm. Para compbrobarlo, buscamos entre los procesos activos:
`top -b | grep "lightdm\|mate"`

Instalamos strace:
```bash
yum install strace
```

### Lista de paquetes instalados:
`yum list installed`

## FreeBSD
### Instalación de VBoxAdditions, entorno gráfico y lightdm/slim
```bash
#!/bin/tcsh

pkg install -y virtualbox-ose-additions xorg xdm mate

cat << EOS >> /etc/rc.conf

moused_enable=YES
vboxguest_enable=YES
vboxservice_enable=YES
hald_enable=YES
dbus_enable=YES
xdm_enable=YES
EOS

foreach user ( 'pc' 'user001' 'user002' 'user003' 'user004' 'user005' 'user006' 'user007' 'user008' 'user009' 'user010')
  echo "exec mate-session" > /home/$user/.xsession
end

portsnap fetch
portsnap extract

# Numero de procesadores del sistema para paralelizar make
NJOBS=$(getconf _NPROCESSORS_ONLN)

cd /usr/ports/shells/bash
make -j$NJOBS install clean BATCH=yes


cd /usr/ports/misc/bb
make -j$NJOBS install clean BATCH=yes
```

## Solaris 11
### Instalación interactiva de VBox Additions y entorno gráfico
Introducimos el CD de VBox Guest Additions y ejecutamos:
```bash
#!/bin/bash

# Actualizar sistema
pkg update

set -e

# El disco se monta automáticamente en /cdrom/<label> o cdrom0
# Confirmamos dos veces con *y*
echo "**************************************"
echo "Inserta el CD de VirtualBox Guest Additions, espera a que se automonte, y pulsa <ENTER> para continuar..."
read
pkgadd -d /cdrom/cdrom0/VBoxSolarisAdditions.pkg


# Entorno de escritorio
pkg install solaris-desktop

# Apagar al terminar para evitarnos errores raros
poweroff
```
### Lista de paquetes instalados
`pkginfo`

### Error raro con resolución DNS
Este es un error que ocurrió a Alonso pero no a Xián, a pesar de tener exactamente la misma configuración e instalación: El DNS no resolvía. Es decir, daba error al hacer `ping www.google.es`, sin embargo no lo daba al hacer `ping 8.8.8.8`.
Esto venía acompañado de mensajes de error del estilo `unable to qualify my own domain name`.

Lo que hicimos fue editar en `/etc/hosts` las línas `::1` y `127.0.0.1` (las locales) y añadirles `aso3.localdomain`.

Tras reiniciar parece que el problema se ha solucionado, lo que nos llama la atención es que no se haya manifestado hasta ahora, ya que en la práctica anterior funcionaba correctamente...

## Ubuntu
