# Practica 5 - ASO

Añadimos las interfaces de red nuevas en las VMs:
- **ASO 1**:
    1. NAT: *Intel PRO/1000MT Desktop*
    2. Red interna: *PCnet-FAST III*
    3. Red interna: *PCnet-FAST III*

- **ASO 2**:
    1. NAT: *Intel PRO/1000MT Desktop*
    2. Red interna: *Intel PRO/1000MT Desktop*
    3. Red interna: *Intel PRO/1000MT Desktop*

- **ASO 3**:
    1. NAT: *Intel PRO/1000MT Desktop*
    2. Red interna: *Intel PRO/1000MT Desktop*
    3. Red interna: *Intel PRO/1000MT Desktop*

## Solaris 10
### Configuración de red
```bash
#!/bin/bash

# set -e

# INTERFACES="e1000g0 pcn0 pcn0:1 pcn0:2 pcn0:3 pcn1 pcn1:1 pcn1:2 pcn1:3"

# interface list $1, command $s2
# loop_ifaces() {
#     echo $1
#     for iface in $1; do
#         echo Plumbing $iface
#         ifconfig $iface $2
#     done
# }

# configure_ifaces() {
#     echo Configuring e1000g0 dhcp
#     ifconfig e1000g0 dhcp

#     echo Configuring pcn0:0..3
#     ifconfig pcn0 inet 192.168.2.11/24
#     ifconfig pcn0:1 inet 192.168.20.11/24
#     ifconfig pcn0:2 inet 192.168.21.11/24
#     ifconfig pcn0:3 inet 192.168.22.11/24

#     echo Configuring pcn1:0..3
#     ifconfig pcn1 inet 192.168.3.11/24
#     ifconfig pcn1:1 inet 192.168.30.11/24
#     ifconfig pcn1:2 inet 192.168.31.11/24
#     ifconfig pcn1:3 inet 192.168.32.11/24
# }

# Configurar
#loop_ifaces "$INTERFACES" plumb
#configure_ifaces
#loop_ifaces "$INTERFACES" up

# Desconfigurar
#loop_ifaces "$INTERFACES" down
#loop_ifaces "$INTERFACES" unplumb

#!/bin/bash

set -e

configure_ifaces_persistent() {
    echo Configuring e1000g0 dhcp
    touch /etc/hostname.e1000g0
    touch /etc/dhcp.e1000g0

    echo Configuring pcn0:0..3
    echo "192.168.2.11 netmask 255.255.255.0" > /etc/hostname.pcn0
    echo "192.168.20.11 netmask 255.255.255.0" >  /etc/hostname.pcn0:1
    echo "192.168.21.11 netmask 255.255.255.0" >  /etc/hostname.pcn0:2
    echo "192.168.22.11 netmask 255.255.255.0" >  /etc/hostname.pcn0:3

    echo Configuring pcn1:0..3
    echo "192.168.3.11 netmask 255.255.255.0" > /etc/hostname.pcn1
    echo "192.168.30.11 netmask 255.255.255.0" >  /etc/hostname.pcn1:1
    echo "192.168.31.11 netmask 255.255.255.0" >  /etc/hostname.pcn1:2
    echo "192.168.32.11 netmask 255.255.255.0" >  /etc/hostname.pcn1:3

    echo Restarting network/physical
    svcadm disable network/physical
    svcadm enable network/physical
}

configure_ifaces_persistent

```
Buscar interfaces: `dmesg | egrep 'e1000g|pcn'`

Comprobar configuración: `ifconfig -a`

## OpenBSD 6.8
### Configuración de red

```bash
#!/bin/csh

echo Configuring em0 dhcp
echo "dhcp" > /etc/hostname.em0
chmod 640 /etc/hostname.em0

echo Configuring pcn0
cat << EOS > /etc/hostname.pcn0
inet 192.168.2.11 255.255.255.0
inet alias 192.168.20.11 255.255.255.0
inet alias 192.168.21.11 255.255.255.0
inet alias 192.168.22.11 255.255.255.0
EOS
chmod 640 /etc/hostname.pcn0

echo Configuring pcn1
cat << EOS > /etc/hostname.pcn1
inet 192.168.3.11 255.255.255.0
inet alias 192.168.30.11 255.255.255.0
inet alias 192.168.31.11 255.255.255.0
inet alias 192.168.32.11 255.255.255.0
EOS
chmod 640 /etc/hostname.pcn1

echo Updating netstart rules
#doas -u root sh /etc/netstart
sh /etc/netstart
```

## Fedora
### Configuración de red
```bash
#!/bin/bash

set -e

# Descomentamos linea para plugin de network manager ifcfg-rh
sed -i '/plugins=ifcfg-rh/s/^#//g' /etc/NetworkManager/NetworkManager.conf

# Interfaz 1
cat << EOS > /etc/sysconfig/network-scripts/ifcfg-enp0s3
DEVICE=enp0s3
ONBOOT=yes
BOOTPROTO=dhcp
EOS

# Interfaz 2
cat << EOS > /etc/sysconfig/network-scripts/ifcfg-enp0s8
DEVICE=enp0s8
ONBOOT=yes
BOOTPROTO=static
IPADDR1=192.168.2.22
NETMASK1=255.255.255.0
IPADDR2=192.168.20.22
NETMASK2=255.255.255.0
IPADDR3=192.168.21.22
NETMASK3=255.255.255.0
IPADDR4=192.168.22.22
NETMASK4=255.255.255.0
EOS

# Interfaz 3
cat << EOS > /etc/sysconfig/network-scripts/ifcfg-enp0s9
DEVICE=enp0s9
ONBOOT=yes
BOOTPROTO=static
IPADDR1=192.168.3.22
NETMASK1=255.255.255.0
IPADDR2=192.168.30.22
NETMASK2=255.255.255.0
IPADDR3=192.168.31.22
NETMASK3=255.255.255.0
IPADDR4=192.168.32.22
NETMASK4=255.255.255.0
EOS

# Reiniciar la red
systemctl restart NetworkManager
```

## Devuan
### Configuración de red

```bash
#!/bin/bash

set -e

echo Configuring interfaces
cat << EOS > /etc/network/interfaces.d/intnet
auto eth1 eth1:1 eth1:2 eth1:3

iface eth1 inet static
    address 192.168.2.11/24

iface eth1:1 inet static
    address 192.168.20.11/24

iface eth1:2 inet static
    address 192.168.21.11/24

iface eth1:3 inet static
    address 192.168.22.11/24


auto eth2 eth2:1 eth2:2 eth2:3

iface eth2 inet static
    address 192.168.3.11/24

iface eth2:1 inet static
    address 192.168.30.11/24

iface eth2:2 inet static
    address 192.168.31.11/24

iface eth2:3 inet static
    address 192.168.32.11/24
EOS

/etc/init.d/networking stop
/etc/init.d/networking start
```

## FreeBSD
### Configuración de red
```bash
#!/bin/tcsh

# Quitamos configuraciones anteriores
sed -i -E '/ifconfig_em/d' /etc/rc.conf

cat << EOS >> /etc/rc.conf

# Configurar DHCP en em0
ifconfig_em0="DHCP"

# Configurar IP en em1
ifconfig_em1="inet 192.168.2.22 netmask 255.255.255.0"
# Y sus alias
ifconfig_em1_alias0="inet 192.168.20.22 netmask 255.255.255.0"
ifconfig_em1_alias1="inet 192.168.21.22 netmask 255.255.255.0"
ifconfig_em1_alias2="inet 192.168.22.22 netmask 255.255.255.0"

# Configurar IP en em2
ifconfig_em2="inet 192.168.3.22 netmask 255.255.255.0"
# Y sus alias
ifconfig_em2_alias0="inet 192.168.30.22 netmask 255.255.255.0"
ifconfig_em2_alias1="inet 192.168.31.22 netmask 255.255.255.0"
ifconfig_em2_alias2="inet 192.168.32.22 netmask 255.255.255.0"
EOS

# Reiniciar la red
/etc/rc.d/netif restart
```

## Solaris 11
### Configuración de red
```bash
#!/bin/bash

set -e

# Configuración por cli
# Interfaz 0 (NAT)
ipadm create-ip net0
ipadm create-addr -T dhcp net0/nat0

# Interfaz 1 (interna .2x)
ipadm create-ip net1
ipadm create-addr -T static -a 192.168.2.33/24  net1/int0
ipadm create-addr -T static -a 192.168.20.33/24 net1/int1
ipadm create-addr -T static -a 192.168.21.33/24 net1/int2
ipadm create-addr -T static -a 192.168.22.33/24 net1/int3

# Interfaz 2 (interna .3x)
ipadm create-ip net2
ipadm create-addr -T static -a 192.168.3.33/24  net2/int0
ipadm create-addr -T static -a 192.168.30.33/24 net2/int1
ipadm create-addr -T static -a 192.168.31.33/24 net2/int2
ipadm create-addr -T static -a 192.168.32.33/24 net2/int3
```

### Notas acerca de Solaris 11
En Solaris 11, hacer `ifconfig -a` no muestra las interfaces, ya que este hace "distinción" entre interfaces lógicas
y físicas.

Para visualizar información sobre las interfaces se utiliza el comando `dladm`, y en concreto para ver la correspondencia con su respectiva interfaz física, se ejecuta `dladm show-phys`.

Por otro lado, para visualizar información sobre ip, se puede utilizar, en typical solaris fashion, `ipadm`, y especialmente `ipadm show-addr` para mostrar las direcciones.

## Ubuntu
### Configuración de red
```bash
#!/bin/bash

set -e

CONFIG_FILE="/etc/netplan/10-intnet.yaml"

echo Creating config file $CONFIG_FILE
cat << EOS > $CONFIG_FILE
network:
    version: 2
    ethernets:
        enp0s8:
            dhcp4: false
            addresses:
                - 192.168.2.33/24
                - 192.168.20.33/24
                - 192.168.21.33/24
                - 192.168.22.33/24
        enp0s9:
            dhcp4: false
            addresses:
                - 192.168.3.33/24
                - 192.168.30.33/24
                - 192.168.31.33/24
                - 192.168.32.33/24
EOS

echo Applying configuration changes
netplan apply
```